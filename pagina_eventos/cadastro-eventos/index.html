<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <link rel="stylesheet" href="globals.css" />
    <link rel="stylesheet" href="style.css" />
    <style>


.dropdown {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  max-height: 150px;
  overflow-y: auto;
  background: #fff;
  border: 1px solid #ccc;
  border-radius: 4px;
  z-index: 999;
  list-style: none;
  padding: 0;
  margin: 5px 0 0 0;
}

.dropdown li {
  padding: 10px;
  cursor: pointer;
}

.dropdown li:hover {
  background-color: #f0f0f0;
}

.hidden {
  display: none;
}

  .overlap-13 {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
  }

  .overlap-13 img {
    width: 24px;
    height: 24px;
    cursor: pointer;
    transition: transform 0.2s;
  }

  .overlap-13 img:hover {
    transform: scale(1.1);
  }

  .table-container {
    width: 100%;
    max-width: 800px;
    overflow-x: auto;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-family: sans-serif;
    font-size: 14px;
  }

  th, td {
    padding: 10px;
    border: 1px solid #ccc;
    text-align: left;
  }

  th {
    background-color: #f4f4f4;
  }

  tr:hover {
    background-color: #f9f9f9;
  }
  #contadorAlertas {
  margin-left: 100px;
  color: #ff0000;
  font-weight: bold;
  font-size: 0.9em;
  background-color: #ffeeee;
  padding: 2px 20px;
  border-radius: 10px;
  display: none; /* Inicialmente oculto */
}
</style>
  </head>
  <script>
function toggleDropdown(id) {
  const dropdown = document.getElementById(id);
  dropdown.classList.toggle('hidden');
}
//COLABORADOR
function selectColaborador(matricula, nome) {
  document.getElementById('colaboradorInput').value = nome;
  document.getElementById('colaboradorHidden').value = matricula;
  toggleDropdown('colaboradorDropdown');
}

document.addEventListener('DOMContentLoaded', () => {
  const dropdown = document.getElementById('colaboradorDropdown');
  const input = document.getElementById('colaboradorInput');

  fetch('../get/get_colaborador.php')
    .then(res => res.json())
    .then(data => {
      data.forEach(colaborador => {
        const li = document.createElement('li');
        li.textContent = colaborador.colaborador_nome;
        li.onclick = () => selectColaborador(colaborador.colaborador_matricula, colaborador.colaborador_nome);
        dropdown.appendChild(li);
      });
    });

  document.addEventListener('click', function (event) {
    if (!dropdown.contains(event.target) && event.target !== input) {
      dropdown.classList.add('hidden');
    }
  });
});
function selectColaborador(matricula, nome) {
  document.getElementById('colaboradorInput').value = nome;
  document.getElementById('colaboradorHidden').value = matricula;
  toggleDropdown('colaboradorDropdown');
}
// CATEGORIA
function selectCategoria(id, nome) {
  document.getElementById('categoriaInput').value = nome;
  document.getElementById('categoriaHidden').value = id;
  toggleDropdown('categoriaDropdown');
  
  // Limpa o motivo selecionado quando muda a categoria
  document.getElementById('motivoInput').value = '';
  document.getElementById('motivoHidden').value = '';
  
  // Carrega os motivos filtrados pela categoria
  carregarMotivosPorCategoria(id);
  // Busca a quantidade de alertas para esta categoria
  buscarAlertasPorCategoria(id);
}
// Função para buscar alertas
function buscarAlertasPorCategoria(categoriaId) {
  fetch(`../get/get_alertas.php?eventoCategoria_id=${categoriaId}`)
    .then(res => res.json())
    .then(data => {
      const contador = document.getElementById('contadorAlertas');
      if (data.ocorreciaCategoria_qtdAlerta > 0) {
        contador.textContent = `(${data.ocorreciaCategoria_qtdAlerta} alertas)`;
        contador.style.display = 'inline';
      } else {
        contador.textContent = '';
        contador.style.display = 'none';
      }
    })
    .catch(error => {
      console.error('Erro ao buscar alertas:', error);
    });
}

// Adicione no DOMContentLoaded
document.addEventListener('DOMContentLoaded', () => {
  // ... outro código existente ...
  
  // Verifica se o contador já existe, se não, cria
  if (!document.getElementById('contadorAlertas')) {
    const contador = document.createElement('span');
    contador.id = 'contadorAlertas';
    contador.style.marginLeft = '100px';
    contador.style.color = '#ff0000';
    contador.style.fontWeight = 'bold';
    contador.style.display = 'none';
    
    // Encontra o label do radio "Sim" e adiciona o contador
    const labelSim = document.querySelector('input[name="evento_alerta"][value="1"]').parentNode;
    labelSim.appendChild(contador);
  }
});
function carregarMotivosPorCategoria(categoriaId) {
  const dropdown = document.getElementById('motivoDropdown');
  dropdown.innerHTML = ''; // Limpa os motivos anteriores
  
  fetch(`../get/get_motivo.php?categoria_id=${categoriaId}`)
    .then(res => res.json())
    .then(data => {
      if (data.length === 0) {
        const li = document.createElement('li');
        li.textContent = 'Nenhum motivo disponível para esta categoria';
        dropdown.appendChild(li);
      } else {
        data.forEach(motivo => {
          const li = document.createElement('li');
          li.textContent = motivo.eventoMotivo_nome;
          li.onclick = () => selectMotivo(motivo.eventoMotivo_id, motivo.eventoMotivo_nome);
          dropdown.appendChild(li);
        });
      }
    });
}

// MOTIVO
function selectMotivo(id, nome) {
  document.getElementById('motivoInput').value = nome;
  document.getElementById('motivoHidden').value = id;
  toggleDropdown('motivoDropdown');
}

// Modifique o evento DOMContentLoaded para a categoria
document.addEventListener('DOMContentLoaded', () => {
  const dropdown = document.getElementById('categoriaDropdown');
  const input = document.getElementById('categoriaInput');

  fetch('../get/get_categoria.php')
    .then(res => res.json())
    .then(data => {
      data.forEach(categoria => {
        const li = document.createElement('li');
        li.textContent = categoria.eventoCategoria_nome;
        li.onclick = () => selectCategoria(categoria.eventoCategoria_id, categoria.eventoCategoria_nome);
        dropdown.appendChild(li);
      });
    });

  document.addEventListener('click', function (event) {
    if (!dropdown.contains(event.target) && event.target !== input) {
      dropdown.classList.add('hidden');
    }
  });
  
  // Inicializa o dropdown de motivos vazio
  const motivoDropdown = document.getElementById('motivoDropdown');
  motivoDropdown.innerHTML = '<li>Selecione uma categoria primeiro</li>';

  // Adicione este código no DOMContentLoaded
document.getElementById('categoriaInput').addEventListener('click', function() {
  // Limpa o motivo quando clicar para selecionar outra categoria
  document.getElementById('motivoInput').value = '';
  document.getElementById('motivoHidden').value = '';
  const motivoDropdown = document.getElementById('motivoDropdown');
  motivoDropdown.innerHTML = '<li>Selecione uma categoria primeiro</li>';
});
});


//DISCENTE
function selectDiscente(matricula, nome) {
  document.getElementById('discenteInput').value = nome;
  document.getElementById('discenteHidden').value = matricula;
  toggleDropdown('discenteDropdown');
}
document.addEventListener('DOMContentLoaded', () => {
  const dropdown = document.getElementById('discenteDropdown');
  const input = document.getElementById('discenteInput');

  fetch('../get/get_discente.php')
    .then(res => res.json())
    .then(data => {
      data.forEach(discente => {
        const li = document.createElement('li');
        li.textContent = discente.discente_nome;
        li.onclick = () => selectDiscente(discente.discente_matricula, discente.discente_nome);
        dropdown.appendChild(li);
      });
    });

  document.addEventListener('click', function (event) {
    if (!dropdown.contains(event.target) && event.target !== input) {
      dropdown.classList.add('hidden');
    }
  });
});
//RESPONSAVEL
function selectResponsavel(matricula, nome) {
  document.getElementById('responsavelInput').value = nome;
  document.getElementById('responsavelHidden').value = matricula;
  toggleDropdown('responsavelDropdown');
}
document.addEventListener('DOMContentLoaded', () => {
  const dropdown = document.getElementById('responsavelDropdown');
  const input = document.getElementById('responsavelInput');

  fetch('../get/get_responsavel.php')
    .then(res => res.json())
    .then(data => {
      data.forEach(responsavel => {
        const li = document.createElement('li');
        li.textContent = responsavel.responsavelLegal_nome;
        li.onclick = () => selectResponsavel(responsavel.responsavelLegal_id, responsavel.responsavelLegal_nome);
        dropdown.appendChild(li);
      });
    });

  document.addEventListener('click', function (event) {
    if (!dropdown.contains(event.target) && event.target !== input) {
      dropdown.classList.add('hidden');
    }
  });
});
document.addEventListener('DOMContentLoaded', function () {
  document.getElementById('formEvento').addEventListener('submit', function(event) {
    const camposObrigatorios = [
      { id: 'colaboradorHidden', nome: 'Colaborador' },
      { id: 'discenteHidden', nome: 'Discente' },
      { id: 'responsavelHidden', nome: 'Responsável' },
      { id: 'categoriaHidden', nome: 'Categoria do Evento' },
      { id: 'motivoHidden', nome: 'Motivo' },
      { name: 'evento_data', nome: 'Data' },
      { name: 'evento_hora', nome: 'Hora' },
      { name: 'evento_idDiscente', nome: 'Discente' }
    ];

    let camposInvalidos = [];

    camposObrigatorios.forEach(campo => {
      const valor = campo.id
        ? document.getElementById(campo.id)?.value
        : document.querySelector(`[name="${campo.name}"]`)?.value;

      if (!valor || valor.trim() === '') {
        camposInvalidos.push(campo.nome);
      }
    });

    if (camposInvalidos.length > 0) {
      event.preventDefault();
      alert('Por favor, preencha os seguintes campos obrigatórios:\n\n- ' + camposInvalidos.join('\n- '));
    }
  });
});
// BUSCAR
function buscarDiscentes() {
  const termo = document.getElementById("buscaDiscente").value;
  const lista = document.getElementById("listaDiscentes");

  if (termo.length < 2) {
    lista.innerHTML = '';
    lista.classList.add('hidden');
    return;
  }

  fetch(`../crud/buscar.php?q=${encodeURIComponent(termo)}`)
    .then(response => response.json())
    .then(discentes => {
      lista.innerHTML = '';
      discentes.forEach(d => {
        const item = document.createElement("li");
        item.textContent = d.discente_nome;
        item.onclick = function () {
  document.getElementById("buscaDiscente").value = d.discente_nome;
  document.getElementById("discenteInput").value = d.discente_nome;
  document.getElementById("discenteHidden").value = d.discente_matricula;
  document.getElementById("responsavelHidden").value = d.responsavelLegal_id;
  document.getElementById("responsavelInput").value = d.responsavelLegal_nome;
  lista.classList.add("hidden");
};


        lista.appendChild(item);
      });
      lista.classList.remove('hidden');
    });
}
//DATA ATUAL
document.addEventListener('DOMContentLoaded', function() {
  // Formata a data atual no formato YYYY-MM-DD que o input date espera
  const hoje = new Date();
  const dia = String(hoje.getDate()).padStart(2, '0');
  const mes = String(hoje.getMonth() + 1).padStart(2, '0'); // Janeiro é 0!
  const ano = hoje.getFullYear();
  
  const dataFormatada = `${ano}-${mes}-${dia}`;
  
  // Define o valor do input
  document.getElementById('evento_data').value = dataFormatada;
});

</script>
  <body>
    <div class="cadastro-de-eventos">
      <div class="div">
        <a href="index2.html">
        <button  class="overlap"><div class="text-wrapper-2">Cancelar</div></button>
      </a> 
       <form id="formEvento" method="POST" action="../crud/confirm.php">
          <button href="index.html" class="overlap-group"><div class="text-wrapper">Confirmar</div></button>
        <div class="rectangle">
          <input type="number" min="0" name="evento_id" placeholder="Selecione" style="all: unset; padding-left: 10px; width: 90%; height: 100%;" readonly />
        </div>
        <div class="overlap-2">
       <div class="dropdown-container">
  <div class="dropdown-container">
    <!--  ===============================================>COLABORADOR<=============================================== -->
 <!-- Campo visível ao usuário -->
<input type="text" id="colaboradorInput" placeholder="Nome:" readonly onclick="toggleDropdown('colaboradorDropdown')" style="all: unset; padding-left: 10px; width: 100%; height: 100%; position: absolute;" />

<!-- Campo oculto -->
<input type="hidden" id="colaboradorHidden" name="evento_idColaborador" />

<img class="expand-arrow" src="https://c.animaapp.com/mb7u88iye7xe8U/img/expand-arrow-4.png" onclick="toggleDropdown('colaboradorDropdown')" />

<!-- Dropdown preenchido dinamicamente -->
<ul id="colaboradorDropdown" class="dropdown hidden"></ul>

</div>

</div>
</div>
        <div class="overlap-3">
           <img class="vector" src="https://c.animaapp.com/mb7u88iye7xe8U/img/vector.svg" />
          <input type="text" id="buscaDiscente"  onkeyup="buscarDiscentes()" autocomplete="off" placeholder="Buscar:" style="all: unset; padding-left: 30px; width: 100%; height: 100%;" />
<ul id="listaDiscentes" class="dropdown hidden"></ul>

<!-- Campos ocultos para matrícula e responsável -->
<input type="hidden" name="evento_idDiscente" id="discenteHidden" />
<input type="hidden" name="evento_idResponsavel" id="responsavelHidden" />


        </div>
<!--  ===============================================>RESPONSAVEL<=============================================== -->
        <div class="overlap-4">
       <!-- Campo visível ao usuário -->
<input type="text" id="responsavelInput" placeholder="Nome do responsavel:" readonly onclick="toggleDropdown('responsavelDropdown')" style="all: unset; padding-left: 10px; width: 100%; height: 100%; position: absolute;" />


<img class="expand-arrow" src="https://c.animaapp.com/mb7u88iye7xe8U/img/expand-arrow-4.png" onclick="toggleDropdown('responsavelDropdown')" />

<!-- Dropdown preenchido dinamicamente -->
<ul id="responsavelDropdown" class="dropdown hidden"></ul>
<!--  ===============================================>CATEGORIA<=============================================== -->
        </div>
       <div class="overlap-5">
  <!-- Campo visível ao usuário -->
<input type="text" id="categoriaInput" name="evento_idCategoria" placeholder="Selecione a categoria:" readonly onclick="toggleDropdown('categoriaDropdown')" style="all: unset; padding-left: 10px; width: 100%; height: 100%; position: absolute;" />

<!-- Campo oculto -->
<input type="hidden" id="categoriaHidden" name="eventoCategoria_id" />

<img class="expand-arrow" src="https://c.animaapp.com/mb7u88iye7xe8U/img/expand-arrow-4.png" onclick="toggleDropdown('categoriaDropdown')" />

<!-- Dropdown preenchido dinamicamente -->
<ul id="categoriaDropdown" class="dropdown hidden"></ul>

</div>

<!--  ===============================================>MOTIVO<=============================================== -->
        <div class="overlap-6">
   <!-- Campo visível ao usuário -->
<input type="text" id="motivoInput" name="evento_idMotivo" placeholder="Selecione o motivo:" readonly onclick="toggleDropdown('motivoDropdown')" style="all: unset; padding-left: 10px; width: 100%; height: 100%; position: absolute;" />

<!-- Campo oculto -->
<input type="hidden" id="motivoHidden" name="eventoMotivo_id" />

<img class="expand-arrow" src="https://c.animaapp.com/mb7u88iye7xe8U/img/expand-arrow-4.png" onclick="toggleDropdown('motivoDropdown')" />

<!-- Dropdown preenchido dinamicamente -->
<ul id="motivoDropdown" class="dropdown hidden"></ul>

</div>
<div class="div-wrapper">
  <textarea name="evento_observacao" maxlength="300" placeholder="Digite a observação aqui..." 
    style="all: unset; padding: 10px; width: 100%; height: 100px; font-family: sans-serif; font-size: 14px; border: 1px; border-radius: 4px;">
  </textarea>
</div>
<div class="rectangle-2">

          <input type="date" name="evento_data" id="evento_data" placeholder="Nome:" style="all: unset; padding-left: 10px; width: 90%; height: 100%;"  />
        </div>
        <div class="text-wrapper-7">ID:</div>
        <div class="text-wrapper-8">Colaborador:</div>
        <div class="text-wrapper-9">Responsável:</div>
        <div class="text-wrapper-10">Categ. Evento:</div>
        <div class="text-wrapper-11">Motivo:</div>
        <div class="text-wrapper-12">Observação:</div>
        <div class="text-wrapper-13">Data:</div>
        <div class="overlap-7">
<!--  ===============================================>DISCENTE<=============================================== -->
         <!-- Campo visível ao usuário -->
<input type="text" id="discenteInput" placeholder="Nome do discente:" readonly onclick="toggleDropdown('discenteDropdown')" style="all: unset; padding-left: 10px; width: 100%; height: 100%; position: absolute;" />


<img class="expand-arrow" src="https://c.animaapp.com/mb7u88iye7xe8U/img/expand-arrow-4.png" onclick="toggleDropdown('discenteDropdown')" />

<!-- Dropdown preenchido dinamicamente -->
<ul id="discenteDropdown" class="dropdown hidden"></ul>
        </div>
        <div class="text-wrapper-14">Discente:</div>
        <div class="overlap-8">
          <div class="text-wrapper-15">Gestão</div>
          <div class="text-wrapper-16">Cadastro de eventos</div>
        </div>
        <div class="rectangle-3">
          <input type="time" name="evento_hora" placeholder="Nome:" style="all: unset; padding-left: 10px; width: 90%; height: 100%;" />
        </div>
        <div class="text-wrapper-17">Hora:</div>
        <div class="overlap-9">
          <div class="rectangle-4">
            
          </div>
          <img class="mdi-user" src="https://c.animaapp.com/mb7u88iye7xe8U/img/mdi-user.svg" />
        </div>
       <!-- Substitua esta parte do seu HTML -->
<div class="overlap-10">
  <div class="text-wrapper-18">Alerta ativo:</div>
  <img
    class="heroicons-solid"
    src="https://c.animaapp.com/mb7u88iye7xe8U/img/heroicons-solid-emoji-happy.svg"
  />
</div>
<div class="overlap-11">
  <div class="text-wrapper-19">
    <label><input type="radio" name="evento_alerta" value="1" checked> Sim</label>
    <span id="contadorAlertas" style="margin-left: 70px; color: #ff0000; font-weight: bold;"></span>
  </div>
  <img
    class="fluent-emoji-sad"
    src="https://c.animaapp.com/mb7u88iye7xe8U/img/fluent-emoji-sad-16-filled.svg"
  />
</div>
        <div class="text-wrapper-20">
          <label><input type="radio" name="evento_alerta" value="0"> Não</label>
        </div>
        <img class="plus-math" src="https://c.animaapp.com/mb7u88iye7xe8U/img/plus-math-3.png" />
        <img class="plus-math-2" src="https://c.animaapp.com/mb7u88iye7xe8U/img/plus-math-3.png" />
         <a href="../categoria_eventos/index.html">
          <img class="plus-math-3" src="https://c.animaapp.com/mb7u88iye7xe8U/img/plus-math-3.png" />
        </a>
        <a href="../motivo-eventos/index.html">
          <img class="plus-math-4" src="https://c.animaapp.com/mb7u88iye7xe8U/img/plus-math-3.png" />
          </a>
        <img class="vector-2" src="https://c.animaapp.com/mb7u88iye7xe8U/img/vector-3.svg" />
        <div class="group"></div>
        <img class="vector-3" src="https://c.animaapp.com/mb7u88iye7xe8U/img/vector-2.svg" />
        <div class="text-wrapper-22">Perfil</div>
        <div class="text-wrapper-21">Alertas</div>
        <div class="text-wrapper-23">Eventos</div><br>
        <div style="margin-top: 30rem; margin-left: 4rem;">
          <a href="../motivo-eventos/index.html" class="text-navbar link-motivo">Motivo</a><br>
        </div>
        <div style="margin-top: 0.2rem; margin-left: 4rem;">
          <a href="../categoria_eventos/index.html" class="link-categoria text-navbar">Categoria</a>
        </div>
        <div class="text-wrapper-24">Ocorrência</div>
        <div class="text-wrapper-26">Ajuda</div>
        <div class="text-wrapper-25">Sair</div>
        <div class="overlap-12">
          <img class="line" src="https://c.animaapp.com/mb7u88iye7xe8U/img/line-5.svg" />
          <div class="ellipse"></div>
        </div>
        <div class="ellipse-3"></div>
        <div class="ellipse-2"></div>
        <img class="line-2" src="https://c.animaapp.com/mb7u88iye7xe8U/img/line-6.svg" />
        <img class="davinci-resolve" src="https://c.animaapp.com/mb7u88iye7xe8U/img/davinci-resolve.png" />
        <img class="siren" src="https://c.animaapp.com/mb7u88iye7xe8U/img/siren.png" />
        <img class="case-study" src="https://c.animaapp.com/mb7u88iye7xe8U/img/case-study.png" />
        <img class="vector-4" src="https://c.animaapp.com/mb7u88iye7xe8U/img/vector-1.svg" />
        <div class="overlap-13">
           <a href="index.html"> 
           <button type="submit" ></button>
    </form>
      <a href="index.html">
      <img class="plus" src="https://c.animaapp.com/mb7u88iye7xe8U/img/plus.png" title="Adicionar" />
     </a>
   <a href="../crud/index.php">
    <img class="document" src="https://c.animaapp.com/mb7u88iye7xe8U/img/document.png" title="Visualizar" />
  </a>

             <a href="../crud/delete_form.php">
    <img class="delete" src="https://c.animaapp.com/mb7u88iye7xe8U/img/delete.png" title="Excluir" />
  </a>
              <a href="../crud/update_form.php">
    <img class="edit-file" src="https://c.animaapp.com/mb7u88iye7xe8U/img/edit-file.png" title="Editar" />
  </a>
              <a href="index.html">
    <img class="refresh" src="https://c.animaapp.com/mb7u88iye7xe8U/img/refresh.png" title="Atualizar" />
  </a>